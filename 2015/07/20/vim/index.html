
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>从 Vim 到 Emacs 到 Evil | milo&#39;s  blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="milo">
    
    <meta name="description" content="&amp;lt;div class=&quot;post-heading&quot;&amp;gt;
    从 Vim 到 Emacs 到 Evil
&amp;lt;/div&amp;gt;
&amp;lt;div class=&quot;post-meta&quot;&amp;gt;
    &amp;lt;span&amp;gt;
        [January 17, 2015](/2015-01/from-Vim-to-Emacs/)
    &amp;lt;/span&amp;gt;
    &amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;
    &amp;lt;span&amp;gt;

        [Emacs](/tags.html#Emacs-ref)

        [Vim](/tags.html#Vim-ref)

    &amp;lt;/span&amp;gt;
    &amp;lt;span&amp;gt;
        [ Comments ](/2015-01/from-Vim-to-Emacs/#disqus_thread)
    &amp;lt;/span&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class=&quot;post-entry&quot;&amp;gt;
半个多月前，缘由 Vim 的一点小需求无法实现，我开始尝试 Emacs。从初窥门径到配置出完全满足我的一切，中途曾一度不可自拔，工作之余、入睡之前都在看 Emacs 的文档资料。发现我的控制欲特别强，不达目的不愿罢休。好在 Emacs 的确是个强大的平台，不负我望，在积累了一定的 elisp 基础之后就很快突破瓶颈，轻松定制出自己的编辑器。折腾 Emacs 就是 “山重水复疑无路，柳暗花明又一村”，时而线索终端而疲惫不堪，时而找到突破而满是成就感。总的来说 Emacs 的许多功能都无法 work out of the box，很多地方缺少面对新手的文档。只有熟悉了 Emacs 的理念，学习了 elisp 这门语言后再去 hack 他，才能为我所用。像 Gentoo 一样，Emacs 非常适合以及需要折腾，因为他只是个 Platform，而非 Editor。
Why我使用 Linux 和 Vim 已有 5 年多，非常喜欢这种工作方式，大三的数据结构作业就是拿 Vim 编辑，用 gcc 编译的。工作后继续用 Vim 写程序，其配置文件也在同事 Linux 玩家的影响下越来越强大。我也 Vim 化了我的大多软件，mutt, firefox, ranger。我很喜欢 hjkl 来移动光标，但有个地方不适用 —— Bash command line，虽然可以 set -o vi 把 bash 设置成 vi 方式的键绑定，但是这种方式来移动光标和操作命令很不方便，远不及默认的 emacs 方式高效（其实叫Readline shortcuts, 很多键绑定和 emacs 是一样的）。
Readline shortcuts 在行编辑的时候非常方便，比如 Ctrl-a 移动到行首，Ctrl-e 移动到行尾，Ctrl-p 上一条命令，Alt-b 后退一个单词，Alt-d 向前删除一个单词……，这些对于需要长时间工作在CLI，敲大量命令的 Linuxer 或 Engineer 是非常方便和高效的。若是 Vi 方式则需要先 Esc 进入 Normal 模式，用 0,$,b,w,e,h,l 来移动光标，再 i,a,dw,x 来编辑或删除。虽然双手都不用离开主键盘区，但显然 Vi 方式在这种行范围内编辑修改的操作要复杂的多。 而且大多数系统或软件都会在编辑内容的时候支持 Readline shortcuts，当发现配置 Cisco 设备时也可以用这些 shortcuts，那是多么的舒服和谐。所以虽然我之前完全没有学过 Emacs，但在长时间的 CLI 磨炼之下，早已熟练掌握其大量快捷键。
一很典型的场景是写配对括号或引号时，我倾向于先写配对的符号再退回来填内容。比如 int main() {} 或 git commit a.sh -m &amp;amp;quot;fix xxx&amp;amp;quot; 用 Emacs 可以直接 Ctrl-b 和 Ctrl-f 来移动光标。而 Vi 则需要用方向键或不断的模式切换来实现相同需求。所以我喜欢在编辑的时候使用 Emacs 方式，而在文件浏览和光标选择的时候使用 Vi 方式，各取其长，这就是我的最终需求。">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/logo.svg">
    <link rel="apple-touch-icon-precomposed" href="/img/logo.svg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="milo&#39;s  blog" title="milo&#39;s  blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="milo&#39;s  blog">milo&#39;s  blog</a></h1>
				<h2 class="blog-motto">milo</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/20/vim/" title="从 Vim 到 Emacs 到 Evil" itemprop="url">从 Vim 到 Emacs 到 Evil</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="milo">milo</a>
    </p>
  <p class="article-time">
    <time datetime="2015-07-20T13:51:36.000Z" itemprop="datePublished">2015-07-20</time>
    更新日期:<time datetime="2015-07-20T13:51:36.000Z" itemprop="dateModified">2015-07-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why"><span class="toc-number">1.</span> <span class="toc-text">Why</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solutions"><span class="toc-number">2.</span> <span class="toc-text">Solutions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configurations"><span class="toc-number">3.</span> <span class="toc-text">Configurations</span></a></li></ol>
		</div>
		
		<pre><code>&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"post-heading"</span>&gt;
    从 Vim 到 Emacs 到 Evil
&lt;/<span class="keyword">div</span>&gt;
&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"post-meta"</span>&gt;
    &lt;span&gt;
        [January <span class="number">17</span>, <span class="number">2015</span>](/<span class="number">2015</span>-<span class="number">01</span>/<span class="keyword">from</span>-Vim-<span class="keyword">to</span>-Emacs/)
    &lt;/span&gt;
    &lt;span&gt;&lt;/span&gt;
    &lt;span&gt;

        [Emacs](/tags.html<span class="comment">#Emacs-ref)</span>

        [Vim](/tags.html<span class="comment">#Vim-ref)</span>

    &lt;/span&gt;
    &lt;span&gt;
        [ Comments ](/<span class="number">2015</span>-<span class="number">01</span>/<span class="keyword">from</span>-Vim-<span class="keyword">to</span>-Emacs/<span class="comment">#disqus_thread)</span>
    &lt;/span&gt;
&lt;/<span class="keyword">div</span>&gt;
&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"post-entry"</span>&gt;
</code></pre><p>半个多月前，缘由 Vim 的一点小需求无法实现，我开始尝试 Emacs。从初窥门径到配置出完全满足我的一切，中途曾一度不可自拔，工作之余、入睡之前都在看 Emacs 的文档资料。发现我的控制欲特别强，不达目的不愿罢休。好在 Emacs 的确是个强大的平台，不负我望，在积累了一定的 elisp 基础之后就很快突破瓶颈，轻松定制出自己的编辑器。折腾 Emacs 就是 “山重水复疑无路，柳暗花明又一村”，时而线索终端而疲惫不堪，时而找到突破而满是成就感。总的来说 Emacs 的许多功能都无法 work out of the box，很多地方缺少面对新手的文档。只有熟悉了 Emacs 的理念，学习了 elisp 这门语言后再去 hack 他，才能为我所用。像 Gentoo 一样，Emacs 非常适合以及需要折腾，因为他只是个 Platform，而非 Editor。</p>
<h2 id="Why">Why</h2><p>我使用 Linux 和 Vim 已有 5 年多，非常喜欢这种工作方式，大三的数据结构作业就是拿 Vim 编辑，用 gcc 编译的。工作后继续用 Vim 写程序，其配置文件也在同事 Linux 玩家的影响下越来越强大。我也 Vim 化了我的大多软件，mutt, firefox, ranger。我很喜欢 hjkl 来移动光标，但有个地方不适用 —— Bash command line，虽然可以 <code>set -o vi</code> 把 bash 设置成 vi 方式的键绑定，但是这种方式来移动光标和操作命令很不方便，远不及默认的 emacs 方式高效（其实叫<a href="http://www.bigsmoke.us/readline/shortcuts" target="_blank" rel="external">Readline shortcuts</a>, 很多键绑定和 emacs 是一样的）。</p>
<p><a href="http://www.bigsmoke.us/readline/shortcuts" target="_blank" rel="external">Readline shortcuts</a> 在行编辑的时候非常方便，比如 <code>Ctrl-a</code> 移动到行首，<code>Ctrl-e</code> 移动到行尾，<code>Ctrl-p</code> 上一条命令，<code>Alt-b</code> 后退一个单词，<code>Alt-d</code> 向前删除一个单词……，这些对于需要长时间工作在CLI，敲大量命令的 Linuxer 或 Engineer 是非常方便和高效的。若是 Vi 方式则需要先 Esc 进入 Normal 模式，用 0,$,b,w,e,h,l 来移动光标，再 i,a,dw,x 来编辑或删除。虽然双手都不用离开主键盘区，但显然 Vi 方式在这种行范围内编辑修改的操作要复杂的多。 而且大多数系统或软件都会在编辑内容的时候支持 Readline shortcuts，当发现配置 Cisco 设备时也可以用这些 shortcuts，那是多么的舒服和谐。所以虽然我之前完全没有学过 Emacs，但在长时间的 CLI 磨炼之下，早已熟练掌握其大量快捷键。</p>
<p>一很典型的场景是写配对括号或引号时，我倾向于先写配对的符号再退回来填内容。比如 <code>int main() {}</code> 或 <code>git commit a.sh -m &amp;quot;fix xxx&amp;quot;</code> 用 Emacs 可以直接 <code>Ctrl-b</code> 和 <code>Ctrl-f</code> 来移动光标。而 Vi 则需要用方向键或不断的模式切换来实现相同需求。所以我喜欢在编辑的时候使用 Emacs 方式，而在文件浏览和光标选择的时候使用 Vi 方式，各取其长，这就是我的最终需求。</p>
<a id="more"></a>
<h2 id="Solutions">Solutions</h2><p>我最早的方案是给 Vim 添加键绑定，如下：</p>
<div class="highlight"><br><br>    &quot; emacs commands in insert mode<br><br>    &quot; ctrl-b/f<br>    imap &lt;C-b&gt; &lt;Left&gt;<br>    imap &lt;C-f&gt; &lt;Right&gt;<br><br>    &quot; alt-b/f<br>    &quot; note the alt-b is generate by ctr-v then press alt-b …<br>    imap ^[b   &lt;S-Left&gt;<br>    imap ^[f   &lt;S-Right&gt;<br><br>    imap &lt;C-a&gt; &lt;Home&gt;<br>    imap &lt;C-e&gt; &lt;End&gt;<br><br>    imap &lt;C-d&gt; &lt;Del&gt;<br>    imap &lt;C-h&gt; &lt;BS&gt;<br>    imap ^[d   &lt;c-o&gt;de<br>    imap &lt;C-w&gt; &lt;c-o&gt;db<br>    imap &lt;C-u&gt; &lt;c-o&gt;d^<br>    imap &lt;C-k&gt; &lt;c-o&gt;d$<br>    `</div>

<pre><code>这些配置是可以工作的，但是有点小副作用，就是在 Insert 模式下按 Esc 进入 Normal 模式 想做些移动或删除动作，若不幸用到 b/f/d 这几个键会再次回到 Insert 模式，这是因为在大多终端下 Alt+x 和 先按 Esc 再按 x 的效果是一样的，且 Vim 没法区分他们。

之后渐渐地对 Emacs 这种无模式的编辑方式很感兴趣，于是想尝试下真正的 Emacs ，想体验完全按 Emacs 的方式来工作，所谓 “得不到的永远在骚动……”。完全是好奇心作祟，也当作挑战吧，毕竟有时候能接触到不一样的强大的东西、能让自己换种思维方式是蛮有趣的。所以这期间我看了不少 Emacs 的教程，练习他的命令、快捷键和操作。也试过 Emacs 下的 Viper 和 Evil，但我总觉得应该尽量先入乡随俗，不然怎能体会到其理念和乐趣。Org-mode 是最先牢牢吸引住我的一个功能，那时的想法是继续用 Vim 作为主编辑器，把 Emacs 当作 Org-mode 工具和平时折腾的乐趣。

决定完全投入 Emacs 是在看到 Reddit 上的一个问答之后： “[<span class="link_label">Switching from Vim. Should I use Emacs + Evil or just straight Emacs?</span>](<span class="link_url">https://www.reddit.com/r/emacs/comments/2mcj85/switching_from_vim_should_i_use_em</span>)” 。 1 楼的回答让我顿悟——“Emacs is a platform. Its keybindings has nothing to do with its spirit.” 是的，Emacs 只是个强大的平台，提供各种定制来满足每个人的不同需求。所以 Thanks [<span class="link_label">Evil</span>](<span class="link_url">https://gitorious.org/evil/pages/Home</span>), 我已把 Emacs 打造成了理想的 “Vim 化的 Emacs Editor” ，我可以纵情使用更方便的方式来工作。然后我还在 .bashrc 里添加了 <span class="code">`alias vi=&amp;#39;emacs -nw&amp;#39;`</span>，我不要纠结他是 Vim, Emacs 还是 Evil，他只是我的编辑器。

Emacs 的定制性非常好，因为每个操作每个按键都是一条命令，加上 elisp 这门真正的语言，需求可以实现得很完美，尤其是 hook 非常强大。

<span class="emphasis">_一些意外收获：_</span>
</code></pre><ul>
<li>写中文更方便，避免了在编辑过程在需要不断的模式切换+输入法切换（虽然在 Vim 下有 fcitx.vim 可以缓解这个问题）</li>
<li>org-mode - 记笔记、记录琐事和管理task很方便。</li>
<li>elisp - 粗略学习了一门新语言，感受了下这个 lisp 的方言，后者很被《黑客与画家》的作者推崇。</li>
<li><p>系统地学习了 Emacs 的快捷键，发现了些之前没意识到的规律和技巧。比如 alt-backspace 向后删单词更精确。</p>
<p><em>一些选择：</em></p>
</li>
<li><p>很多人建议互换<code>CapsLock</code>和<code>Ctrl</code>以避免<a href="http://en.wikipedia.org/wiki/Emacs#.22Emacs_pinky.22" target="_blank" rel="external">&quot;Emacs pinky&quot;</a>。我没有换，因为我有 Evil 和 “压掌大法”。</p>
</li>
<li>Emacs 在 23.1 之后支持以 daemon 运行以提高启动速度，我不打算以他做为主要运行方式，一是他会造成很多不好解决的问题，比如 daemon 启动在 terminal 下，然后 emacsclient 运行在 GUI 或 screen 会有些麻烦; 二是我觉得我的 Emacs 启动速度还可以接受。</li>
<li>很多人喜欢在 Emacs 里 do anything, 比如上 IRC 和 发邮件，我没有心动，因为我觉的 irssi 和 mutt 都很好。</li>
<li>很多人喜欢借助 Emacs daemon 来代替 screen 或 tmux，我依然坚持 screen，因为我习惯了用好多 screen 管理着不同的终端，不想折腾到这个层面。*   很多人很喜欢 Emacs 的分屏功能，把他当作窗口管理器来使用。我没有这个念头，因为我有强大的 Awesome WM。</li>
<li>ctrl-w, ctrl-u 这两组快捷键在 bash 和 emacs 的功能完全不一样，我没有调整他们在 Emacs 里对应的命令，而是选择避免在 bash 里用这两组键，前者用 alt-b + alt-d 或 alt-backspace 来代替，后者用 ctrl-a + ctrl-k 来代替。因为我想用最简单的方式兼容。</li>
<li><p>我主要是以 <code>-nw</code> 的方式启动 Emacs，虽然他在终端下有些问题。</p>
<p><em>一些相关的调整：</em></p>
</li>
<li><p>Screen: ctrl-a 这么重要的按键有冲突，不得不调整，我把它换成了 ctrl-j。因为 ctrl-j 在大多 mode 下的功能和回车是一样的，除了在 Lisp Interaction mode 下的作用是运行当前lisp命令，这个小牺牲是可以的。(<a href="https://github.com/ceyes/dotfiles/commit/ba2a732300f72e5c903bced190662c3b2dc68d41" target="_blank" rel="external">我的 commit ba2a73</a>)</p>
</li>
<li><p>Awesome WM: 同样为 Emacs 让路，调整了些 alt 相关的快捷键。 (<a href="https://github.com/ceyes/dotfiles/commit/84060e6aa6bb1cc88afa9d8f16c829570e93f592a" target="_blank" rel="external">我的 commit 84060e</a>)</p>
<h2 id="Configurations">Configurations</h2><p>我的配置文件在Github上：<a href="https://github.com/ceyes/dotfiles/tree/master/.emacs.d" target="_blank" rel="external">https://github.com/ceyes/dotfiles/tree/master/.emacs.d</a><br>一些重要的配置如下：</p>
</li>
</ul>
<ol>
<li><a href="https://gitorious.org/evil/pages/Home" target="_blank" rel="external">Evil</a>, extensible vi layer for Emacs<br>默认配置完全模拟 Vim，除了用 Ctr-z 来切换模式。我调整成了在 Insert 模式下恢复 Emacs 键绑定，用 Esc 退到 Normal 模式。<br>参考了 <a href="https://gist.github.com/kidd/1828878" target="_blank" rel="external">https://gist.github.com/kidd/1828878</a> 和 <a href="http://askubuntu.com/questions/99160/how-to-remap-emacs-evil-mode-toggle-key-from-ctrl-z" target="_blank" rel="external">http://askubuntu.com/questions/99160/how-to-remap-emacs-evil-mode-toggle-key-from-ctrl-z</a>    <div class="highlight"><pre><code>&lt;span class=&quot;c1&quot;&gt;;; Enable evil&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-toggle-key&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;; remove default evil-toggle-key C-z, manually setup later&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-want-C-i-jump&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;; don&amp;#39;t bind [tab] to evil-jump-forward&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;evil-mode&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; remove all keybindings from insert-state keymap, use emacs-state when editing&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;setcdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-insert-state-map&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; ESC to switch back normal-state&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-insert-state-map&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;[escape]&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil-normal-state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; TAB to indent in normal-state&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-normal-state-map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;kbd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;TAB&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;indent-for-tab-command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; Use j/k to move one visual line insted of gj/gk&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-normal-state-map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;kbd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;remap&amp;gt; &amp;lt;evil-next-line&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil-next-visual-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-normal-state-map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;kbd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;remap&amp;gt; &amp;lt;evil-previous-line&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil-previous-visual-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-motion-state-map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;kbd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;remap&amp;gt; &amp;lt;evil-next-line&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil-next-visual-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;define-key&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evil-motion-state-map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;kbd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;remap&amp;gt; &amp;lt;evil-previous-line&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;evil-previous-visual-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;</code></pre></div></li>
<li><a href="https://github.com/sellout/emacs-color-theme-solarized" target="_blank" rel="external">Solarized Colorscheme for Emacs</a>,<br><a href="http://ethanschoonover.com/solarized" target="_blank" rel="external">Solarized</a> 是我最喜欢的配色方案，终端工作和写代码很舒服。但是发现在我的终端(rxvt-unicode-256color)下显示不正常(<a href="https://github.com/sellout/emacs-color-theme-solarized/issues/62" target="_blank" rel="external">issue #62</a>), Workaround 是设置环境变量 <code>TERM=xterm</code>，所以我在 .bashrc 添加了些 alias:<br><div class="highlight"><pre><code>&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;emacs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;TERM=xterm emacs&amp;#39;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# workaround for emacs-color-theme-solarized issue #62&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;emacsclient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;TERM=xterm emacsclient&amp;#39;&lt;/span&gt;</code></pre></div><br>还一问题是该配色在 emacsclient 下的显示也不正常(<a href="https://github.com/sellout/emacs-color-theme-solarized/issues/60" target="_blank" rel="external">issue #60</a>), Workaround 如下：<br><div class="highlight"><pre>`<span class="c1">;; solarized color theme</span><br><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;custom-theme-load-path</span> <span class="s">&quot;~/.emacs.d/emacs-color-theme-solarized/&quot;</span><span class="p">)</span><br><span class="p">(</span><span class="nv">load-theme</span> <span class="ss">&#39;solarized-dark</span> <span class="no">t</span><span class="p">)</span><br><span class="c1">;; Workaround broken solarized colours in emacsclient. Issue #60</span><br><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">daemonp</span><span class="p">)</span><pre><code><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>add-hook<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"ss"</span>&gt;</span>&amp;#39;after-make-frame-functions<span class="tag">&lt;/<span class="title">span</span>&gt;</span>
      <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"k"</span>&gt;</span>lambda<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>frame<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>)<span class="tag">&lt;/<span class="title">span</span>&gt;</span>
    <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>select-frame<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>frame<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>)<span class="tag">&lt;/<span class="title">span</span>&gt;</span>
    <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>load-theme<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"ss"</span>&gt;</span>&amp;#39;solarized-dark<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"no"</span>&gt;</span>t<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>)))<span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>(<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"nv"</span>&gt;</span>load-theme<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"ss"</span>&gt;</span>&amp;#39;solarized-dark<span class="tag">&lt;/<span class="title">span</span>&gt;</span> <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"no"</span>&gt;</span>t<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"p"</span>&gt;</span>))<span class="tag">&lt;/<span class="title">span</span>&gt;</span>
</code></pre>`</pre></div><br>Update: 这两个 issue 已经被修复，在 rxvt-unicode-256color 和 screen-256color 都表现的很好，所以我已去掉了上面的 workarounds。</li>
<li>Dynamic title<br>我喜欢让 terminal 的 title 实时显示 Emacs 正在编辑的文件，emacswiki 的 <a href="http://www.emacswiki.org/emacs/FrameTitle" target="_blank" rel="external">FrameTitle</a> 一文有介绍如何借助 xterm-title.el 设置 Xterm 的 title。不过我采用的是直接向 terminal 发送转义码的方案，支持 xterm/urxvt 和 screen。代码如下：<div class="highlight"><pre><code>&lt;span class=&quot;c1&quot;&gt;;; Automatically set screen title&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; ref http://vim.wikia.com/wiki/Automatically_set_screen_title&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; FIXME: emacsclient in xterm will have problem if emacs daemon start in screen&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;update-title&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;getenv&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;STY&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;; check whether in GNU screen&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;send-string-to-terminal&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;concat&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\033k\033\134\033k&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Emacs(&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;buffer-name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\033\134&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;send-string-to-terminal&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;concat&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\033]2; &amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Emacs(&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;buffer-name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\007&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-hook&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;post-command-hook&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;update-title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;</code></pre></div></li>
<li>Use xsel to access the X clipboard<br>终端下的 Emacs 访问系统剪切板，方便不同程序间的复制粘贴，from  <a href="https://hugoheden.wordpress.com/2009/03/08/copypaste-with-emacs-in-terminal/" target="_blank" rel="external">https://hugoheden.wordpress.com/2009/03/08/copypaste-with-emacs-in-terminal/</a><div class="highlight"><pre><code>&lt;span class=&quot;c1&quot;&gt;;; Use xsel to access the X clipboard&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; From https://hugoheden.wordpress.com/2009/03/08/copypaste-with-emacs-in-terminal/&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;window-system&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;getenv&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;DISPLAY&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;;; Callback for when user cuts&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xsel-cut-function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;optional&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;; Insert text to temp-buffer, and &amp;quot;send&amp;quot; content to xsel stdin&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;with-temp-buffer&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;c1&quot;&gt;;; Use primary the primary selection&lt;/span&gt;
       &lt;span class=&quot;c1&quot;&gt;;; mouse-select/middle-button-click&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;call-process-region&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;point-min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;point-max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;xsel&amp;quot;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;--primary&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;--input&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;;; Call back for when user pastes&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xsel-paste-function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;; Find out what is current selection by xsel. If it is different&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;; from the top of the kill-ring (car kill-ring), then return&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;; it. Else, nil is returned, so whatever is in the top of the&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;; kill-ring will be used.&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xsel-output&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;shell-command-to-string&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;xsel --primary --output&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;kill-ring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xsel-output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;xsel-output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;;; Attach callbacks to hooks&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;interprogram-cut-function&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;xsel-cut-function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;interprogram-paste-function&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;xsel-paste-function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;</code></pre></div></li>
<li>Paste mode for Emacs<br>模仿 Vim 的 <code>:set paste</code>, 这是我最喜欢的复制粘贴方式——鼠标选中即复制，鼠标中键粘贴。不过在终端下，Vim/Emacs 不识别鼠标中键（没有特别编译和设置的情况），被复制的内容会被按照字符依次输入的方式送入终端。然后 Vim/Emacs 会“智能”地把传入内容补全的乱七八糟、把格式缩进的错乱不堪。Vim下打开 “paste mode” 可以解决这个问题，但是 Emacs 没有“paste mode”，所以得自己实现，From <a href="http://stackoverflow.com/questions/18691973/is-there-a-set-paste-option-in-emacs-to-paste-paste-from-external-clipboard" target="_blank" rel="external">http://stackoverflow.com/questions/18691973/is-there-a-set-paste-option-in-emacs-to-paste-paste-from-external-clipboard</a><div class="highlight"><pre><code>&lt;span class=&quot;c1&quot;&gt;;; Mimic Vim&amp;#39;s set paste&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;; From http://stackoverflow.com/questions/18691973/is-there-a-set-paste-option-in-emacs-to-paste-paste-from-external-clipboard&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defvar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ttypaste-mode&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-to-list&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;minor-mode-alist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ttypaste-mode&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; Paste&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ttypaste-mode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current-buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ttypaste-mode&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;with-temp-buffer&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;stay&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current-buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;redisplay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stay&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;inhibit-redisplay&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;read-event&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;with-current-buffer&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert-buffer-substring&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;erase-buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;redisplay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;read-event&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;characterp&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stay&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;?\r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;?\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;?\e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sit-for&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;nodisp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;setq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stay&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;?\e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;insert-buffer-substring&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;</code></pre></div></li>
<li>Setup smart-mode-line<br>用以定制漂亮的状态栏，Vim 下我用的是 powerline。Emacs 版的 powerline 无法用在终端下，所以找到了这个 smart-mode-line。<div class="highlight"><pre>`<span class="c1">;; Smart mode-line</span><br><span class="p">(</span><span class="k">setq</span> <span class="nv">sml/name-width</span>        <span class="mi">40</span><br>      <span class="nv">sml/line-number-format</span>    <span class="s">&quot;%4l&quot;</span><br>      <span class="nv">sml/mode-width</span>        <span class="ss">&#39;full</span><br>      <span class="nv">sml/themea</span>        <span class="ss">&#39;dark</span><br>      <span class="nv">sml/no-confirm-load-theme</span> <span class="no">t</span><span class="p">)</span><br><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;smart-mode-line</span><span class="p">)</span><br><span class="p">(</span><span class="nv">sml/setup</span><span class="p">)</span><br><span class="c1">;; Hidden minor-mode, by rich-minority</span><br><span class="p">(</span><span class="k">setq</span> <span class="nv">rm-excluded-modes</span><br>      <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot; Guide&quot;</span>            <span class="c1">;; guide-key mode</span><br>    <span class="s">&quot; hc&quot;</span>               <span class="c1">;; hardcore mode</span><br>    <span class="s">&quot; AC&quot;</span>               <span class="c1">;; auto-complete</span><br>    <span class="s">&quot; vl&quot;</span>               <span class="c1">;; global visual line mode enabled</span><br>    <span class="s">&quot; Wrap&quot;</span>             <span class="c1">;; shows up if visual-line-mode is enabled for that buffer</span><br>    <span class="s">&quot; Omit&quot;</span>             <span class="c1">;; omit mode in dired</span><br>    <span class="s">&quot; yas&quot;</span>              <span class="c1">;; yasnippet</span><br>    <span class="s">&quot; drag&quot;</span>             <span class="c1">;; drag-stuff-mode</span><br>    <span class="s">&quot; VHl&quot;</span>              <span class="c1">;; volatile highlights</span><br>    <span class="s">&quot; ctagsU&quot;</span>           <span class="c1">;; ctags update</span><br>    <span class="s">&quot; Undo-Tree&quot;</span>            <span class="c1">;; undo tree</span><br>    <span class="s">&quot; wr&quot;</span>               <span class="c1">;; Wrap Region</span><br>    <span class="s">&quot; SliNav&quot;</span>           <span class="c1">;; elisp-slime-nav</span><br>    <span class="s">&quot; Fly&quot;</span>              <span class="c1">;; Flycheck</span><br>    <span class="s">&quot; PgLn&quot;</span>             <span class="c1">;; page-line-break</span><br>    <span class="s">&quot; GG&quot;</span>               <span class="c1">;; ggtags</span><br>    <span class="s">&quot; ElDoc&quot;</span>            <span class="c1">;; eldoc</span><br>    <span class="s">&quot; hl-highlight&quot;</span>         <span class="c1">;; hl-anything</span><br>    <span class="p">))</span><br></pre></div></li>
<li><a href="https://github.com/cinsk/emacs-vim-modeline" target="_blank" rel="external">emacs-vim-modeline</a> - Read file&#39;s vim modeline to set Emacs&#39;s file local variable. 很赞的插件</li>
</ol>
<p>modeline 即在文件中告诉编辑器来启用/调整一些设定的内容，如文件类型、tab 宽度等等。 比如我喜欢在 common 脚本里加上 <code># vim: sts=4 sw=4 et</code> 来保持代码风格一致。</p>
<p>Vim 把这些内容叫 modeline，不过这个词在 Emacs 里表示的是状态栏，所以 Emacs 称之为 file &#39;s local variable。两者写法截然不同，所以这个插件很好的解决了这个问题——读取 Vim 的 modeline 来设置 Emacs。因此我能非常平滑地切换到 Emacs 继续编辑之前的代码。</p>
<p><em>Notes:</em></p>
<ul>
<li>Tab 的功能和配置往往让人迷惑，可以参考 <a href="http://www.pement.org/emacs_tabs.htm" target="_blank" rel="external">Understanding GNU Emacs and Tabs</a> 和 <a href="http://ergoemacs.org/emacs/emacs_tabs_space_indentation_setup.html" target="_blank" rel="external">http://ergoemacs.org/emacs/emacs_tabs_space_indentation_setup.html</a></li>
<li>很多按键在终端下是无法被正确识别的，比如 M-&lt;up&gt;, C-RET, S-RET。 这在终端下使用 org-mode 和 markdown-mode 会有不少麻烦。详见 <a href="http://orgmode.org/manual/TTY-keys.html#TTY-keys" target="_blank" rel="external">http://orgmode.org/manual/TTY-keys.html#TTY-keys</a> 和 <a href="http://stackoverflow.com/questions/3528713/how-does-one-send-s-ret-to-emacs-in-a-terminal" target="_blank" rel="external">http://stackoverflow.com/questions/3528713/how-does-one-send-s-ret-to-emacs-in-a-terminal</a></li>
<li><p>Emacs 的 keybind 有许多复杂的机制，自己配置的时候难免踩到坑，这几篇文档很有帮助：</p>
<p><a href="http://ergoemacs.org/emacs/emacs_key_notation_return_vs_RET.html" target="_blank" rel="external">http://ergoemacs.org/emacs/emacs_key_notation_return_vs_RET.html</a></p>
<p><a href="http://ergoemacs.org/emacs/keyboard_shortcuts_examples.html" target="_blank" rel="external">http://ergoemacs.org/emacs/keyboard_shortcuts_examples.html</a></p>
<p><a href="http://ergoemacs.org/emacs/keyboard_shortcuts.html" target="_blank" rel="external">http://ergoemacs.org/emacs/keyboard_shortcuts.html</a></p>
</li>
<li>我遇到不少功能都在终端下无法正常工作，所以配置的时候最好用 CLI 和 GUI 一起 debug。</li>
<li>Gentoo 编译带 X 的 Emacs 需要添加 USE &quot;gsettings xft&quot;，否则找不到系统字体。</li>
</ul>
<p><em>References:</em></p>
<ul>
<li>入门最好的教材就是自带的 Emacs 快速指南： <code>c-h t</code></li>
<li>查询某个键绑定可通过：<code>c-h k</code></li>
<li>Xah，李杀，一个 Emacs 狂热分子，他的文章很有学习价值：<a href="http://ergoemacs.org/emacs/emacs.html" target="_blank" rel="external">http://ergoemacs.org/emacs/emacs.html</a></li>
<li>EmacsWiki: <a href="http://www.emacswiki.org/" target="_blank" rel="external">http://www.emacswiki.org/</a></li>
</ul>
<p>-EOF-</p>
<pre><code><span class="tag">&lt;/div&gt;</span>
</code></pre><p></p>
<div class="post-blank post-pager">

<p></p></div><p></p>
<p><div id="disqus_thread"></div></p>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ceyes'; // Required - Replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the [comments powered by Disqus.](http://disqus.com/?ref_noscript)</noscript>
[blog comments powered by <span class="logo-disqus">Disqus</span>](http://disqus.com)

<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'ceyes'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<pre><code>&lt;/<span class="keyword">div</span>&gt;
&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"page-footer"</span>&gt;
    &lt;span&gt;
</code></pre><p> [ceyes@gentoo ~]$ emerge —ask —newuse —update —deep world # 行路難 行路難 多歧路 今安在 長風破浪會有時 直掛雲帆濟滄海 </p>
<p>&copy; 2015. All rights reserved.<br>                Powered by <a href="https://github.com/mojombo/jekyll" target="_blank" rel="external">Jekyll. </a><br>                Hosted by <a href="http://github.com" target="_blank" rel="external">Github.com</a></p>
<pre><code>    <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/static/js/bootstrap.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/static/google-code-prettify/prettify.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
   $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
       $(<span class="string">'pre'</span>).addClass(<span class="string">'prettyprint'</span>).attr(<span class="string">'style'</span>, <span class="string">'overflow:auto'</span>);
       prettyPrint();
   });
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined"></span>
</code></pre><p>  (function(i,s,o,g,r,a,m){i[‘GoogleAnalyticsObject’]=r;i[r]=i[r]||function(){<br>  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),<br>  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)<br>  })(window,document,’script’,’//www.google-analytics.com/analytics.js’,’ga’);</p>
<p>  ga(‘create’, ‘UA-63598608-1’, ‘auto’);<br>  ga(‘send’, ‘pageview’);</p>
<p></p>
<p><br></p>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/07/20/vim/" data-title="从 Vim 到 Emacs 到 Evil | milo&#39;s  blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/07/20/Django/"  title="Django 部署(nginx)">
 <strong>NEXT:</strong><br/> 
 <span>Django 部署(nginx)
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why"><span class="toc-number">1.</span> <span class="toc-text">Why</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solutions"><span class="toc-number">2.</span> <span class="toc-text">Solutions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configurations"><span class="toc-number">3.</span> <span class="toc-text">Configurations</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  

  

  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="milo">milo</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
